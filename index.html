<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>加速度センサー</title>
</head> 
<body>
  <button id="start" onclick="permission_request();">start</button>
  <button id="stp" onclick="stopmotion();">stop</button>
  <button id="reset" onclick="resetmotion();">reset</button>
  <p>錘</p>
  <div id="txt">表示</div>
  <p>錘の動き</p>
  <canvas id="canvas" width="300" height="400"></canvas>

  <p>携帯の加速度</p>
  <div id="txt1">表示</div>
  <p>加速度の大きさの合力</p>
  <div id="txt2">表示</div>
  <p>速度</p>
  <div id="txt3">表示</div>
  <p>力が加わっている方向</p>
  <canvas id="canvas1" width="300" height="400"></canvas>

  <!-- <p>加速度-時間グラフ</p>
  <canvas id="canvas2" width="800" height="800"></canvas> -->



  <script>
    // const start = document.getElementById('start');
    // const stp = document.getElementById('stp');
    // const reset = document.getElementById('reset');

    
    

    let aX = 0, aY = 0, aZ = 0;
    let canvas = document.getElementById('canvas');
    let context = canvas.getContext('2d');
    let timer = window.setInterval(() => {
      displayDate();
      drawBall();
    }, 33);

    let bX = 0, bY = 0, bZ = 0;
    let canvas1 = document.getElementById('canvas1');
    let context1 = canvas1.getContext('2d');
    let timer1 = window.setInterval(() => {
      displayDate1();
      drawBall1();
    }, 33);

    // function setButtonStateInitial() {
    //   start.classList.remove('inactive');
    //   stp.classList.add('inactive');
    //   reset.classList.add('inactive');
    // }
    // function setButtonStateRunning() {
    //   start.classList.add('inactive');
    //   stp.classList.remove('inactive');
    //   reset.classList.add('inactive');
    // }
    // function setButtonStateStopped() {
    //   start.classList.remove('inactive');
    //   stp.classList.add('inactive');
    //   reset.classList.remove('inactive');
    // }

    // setButtonStateInitial();

   
    
    
    function post_function( result_string ) {
      if ( result_string === "granted" ) {
        
      }
      else if ( result_string === "denied" ) {
        
      }
    }

    function permission_request() {
      
      if ( DeviceOrientationEvent
      && DeviceOrientationEvent.requestPermission
      && typeof DeviceOrientationEvent.requestPermission === 'function'
      ) {
        DeviceMotionEvent.requestPermission().then( post_function );
        window.addEventListener( "devicemotion", function(e) {
          aX = e.accelerationIncludingGravity.x;
          aY = e.accelerationIncludingGravity.y;
          aZ = e.accelerationIncludingGravity.z;
          bX = e.acceleration.x;
          bY = e.acceleration.y;
          bZ = e.acceleration.z;
          let os1 = navigator.platform;
        if (os1 === "iPhone" || os1 === "iPad" || os1 === "iPod") {
            aX *= -1;
            aY *= -1;
            aZ *= -1;
            bX *= -1;
            bY *= -1;
            bZ *= -1;
          }

        }, false );
      }
      if ( DeviceOrientationEvent
      && DeviceOrientationEvent.requestPermission
      && typeof DeviceOrientationEvent.requestPermission === 'function'
      ) {
        DeviceOrientationEvent.requestPermission().then( post_function );
        window.addEventListener( "deviceorientation", function(e) {
          // 角度を変えたい時の処理
        }, false );
      }
    }
    
    function displayDate() {
      let txt = document.getElementById("txt");
      txt.innerHTML = "x:" + aX + "m/s<sup>2</sup>" + "<br>"
                    + "y:" + aY + "m/s<sup>2</sup>" + "<br>"
                    + "z:" + aZ + "m/s<sup>2</sup>";
      
    }
    function displayDate1() {
      let txt1 = document.getElementById("txt1");
      txt1.innerHTML = "x:" + bX + "m/s<sup>2</sup>" + "<br>"
                     + "y:" + bY + "m/s<sup>2</sup>" + "<br>"
                     + "z:" + bZ + "m/s<sup>2</sup>";
      let txt2 = document.getElementById("txt2");
      let ac = (bX * bX + bY * bY + bZ * bZ) * 0.5
      txt2.innerHTML = ac + "m/s<sup>2</sup>";

      let array = [0];
      array.push(ac);

      let n = 0;
      let acc = array[n + 1] - array[n];
      let v = acc * 0.33;

      txt3.innerHTML = v + "m/s";


      
    }


    
    
    function drawBall() {
      let centerX = canvas.width / 2;
      let centerY = canvas.height / 2;
      let ballRad = 50;
      // let ballColor = "rgb(100, 100, 255)";
      let g = 9.80665;
      let d = centerX / g;
      // let os = navigator.platform;
      // if (os === "iPhone" || os === "iPad" || os === "iPod") {
      //     aX *= -1;
      //     aY *= -1;
      //     aZ *= -1;
      //   }
      context.clearRect(0, 0, canvas.width, canvas.height);
      context.beginPath();
      context.arc(centerX - d * aX,
                  centerY + d * aY,
                  ballRad = 3 * aZ,
                  0, 2 * Math.PI);
      // context.fillStyle = "rgba(0, 0, 255, 0.5)";
      context.fill();
      }
    
    
    function drawBall1() {
      let centerX1 = canvas1.width / 2;
      let centerY1 = canvas1.height / 2;
      // let ballRad1 = 30;
      // let ballColor1 = "rgb(255, 0, 0)";
      let g = 9.80665;
      let d1 = centerX1 / g;
      let os1 = navigator.platform;
      if (os1 === "iPhone" || os1 === "iPad" || os1 === "iPod") {
        bX *= -1;
        bY *= -1;
        bZ *= -1;
      }
      context1.clearRect(0, 0, canvas1.width, canvas1.height);
      context1.beginPath();
      context1.rect(centerX1 - d1 * bX,
                    centerY1 + d1 * bY, 50, 50);
      context1.fillStyle = "orange";
      context1.fill();
      }


    function stopmotion() {
      clearInterval(timer);
      clearInterval(timer1);
    }

    function resetmotion() {
      numberreset = "x:" + 0.00 + "m/s<sup>2</sup>" + "<br>"
                  + "y:" + 0.00 + "m/s<sup>2</sup>" + "<br>"
                  + "z:" + 0.00 + "m/s<sup>2</sup>";
      txt.innerHTML = numberreset;
      txt1.innerHTML = numberreset;

    }


    // function makeTable() {
    //   let rows=[];
    //   let table = document.createElement("table");

    //   for(i = 0; i < data.length; i++){
    //     rows.push(table.insertRow(-1));
    //   }

    //   document.getElementById(tableId).appendChild(table);
    // }
    // window.onload = function(){
    //   let data = 0;
    //   data = bX + bY + bZ
    //   makeTable(data,"table");
    // };

      
  </script>
   <!-- <div id="table"></div> -->

  
   <!-- <button onclick="permission_request();">動作と方向へのアクセス許可</button> -->

</body>
</html>