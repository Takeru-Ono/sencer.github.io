<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>加速度センサー</title>
</head> 
<body>
  <p>錘の加速度</p>
  <div id="txt">表示</div>
  <canvas id="canvas" width="300" height="400"></canvas>

  <p>箱の加速度</p>
  <div id="txt1">表示</div>
  <canvas id="canvas1" width="300" height="400"></canvas>


  <script>
    let aX = 0, ay = 0, aZ = 0;
    let canvas = document.getElementById('canvas');
    let context = canvas.getContext('2d');
    let timer = window.setInterval(() => {
      displayDate();
      drawBall();
    }, 33);

    let bX = 0, by = 0, bZ = 0;
    let canvas1 = document.getElementById('canvas1');
    let context1 = canvas1.getContext('2d');
    let timer1 = window.setInterval(() => {
      displayDate1();
      drawBall1();
    }, 33);
    
    
    function post_function( result_string ) {
      if ( result_string === "granted" ) {
        
      }
      else if ( result_string === "denied" ) {
        
      }
    }
    function permission_request() {
      if ( DeviceOrientationEvent
      && DeviceOrientationEvent.requestPermission
      && typeof DeviceOrientationEvent.requestPermission === 'function'
      ) {
        DeviceMotionEvent.requestPermission().then( post_function );
        window.addEventListener( "devicemotion", function(e) {
          aX = e.accelerationIncludingGravity.x;
          aY = e.accelerationIncludingGravity.y;
          aZ = e.accelerationIncludingGravity.z;
          bX = e.acceleration.x;
          bY = e.acceleration.y;
          bZ = e.acceleration.z;

        }, false );
      }
      if ( DeviceOrientationEvent
      && DeviceOrientationEvent.requestPermission
      && typeof DeviceOrientationEvent.requestPermission === 'function'
      ) {
        DeviceOrientationEvent.requestPermission().then( postf_unction );
        window.addEventListener( "deviceorientation", function(e) {
          // 角度を変えたい時の処理
        }, false );
      }
    }
    
    function displayDate() {
      let txt = document.getElementById("txt");
      txt.innerHTML = "x:" + aX + "<br>"
                    + "y:" + aY + "<br>"
                    + "z:" + aZ;
    }
    function displayDate1() {
      let txt1 = document.getElementById("txt1");
      txt1.innerHTML = "x:" + bX + "<br>"
                     + "y:" + bY + "<br>"
                     + "z:" + bZ;
    }


    
    
    function drawBall() {
        let centerX = canvas.width / 2;
        let centerY = canvas.height / 2;
        let ballRad = 50;
        let ballColor = "rgba(100, 100, 255, 0.6)";
        let g = 9.80665;
        let d = centerX / g;
        let os = navigator.platform;
        if (os === "iPhone" || os === "iPad" || os === "iPod") {
            aX *= -1;
            aY *= -1;
            aZ *= -1;
          }
          context.clearRect(0, 0, canvas.width, canvas.height);
          context.beginPath();
          context.arc(centerX - d * aX,
                      centerY + d * aY,
                      ballRad = 3 * aZ,
                      0, 2 * Math.PI);
          context.fillstyle = ballColor;
          context.fill();
        }
    
    
    function drawBall1() {
        let centerX1 = canvas1.width / 2;
        let centerY1 = canvas1.height / 2;
        let ballRad1 = 30;
        let ballColor1 = "rgba(255, 0, 0, 0.6)";
        let g = 9.80665;
        let d1 = centerX1 / g;
        // let os1 = navigator.platform;
        // if (os1 === "iPhone" || os1 === "iPad" || os1 === "iPod") {
        //     bX *= -1;
        //     bY *= -1;
        //     bZ *= -1;
        //   }
          context1.clearRect(0, 0, canvas1.width, canvas1.height);
          context1.beginPath();
          context1.arc(centerX1 - d1 * bX,
                      centerY1 + d1 * bY,
                      ballRad1,
                      0, 2 * Math.PI);
          context1.fillstyle = ballColor1;
          context1.fill();
        }
  </script>
  <button onclick="permission_request();">動作と方向へのアクセス許可</button>
</body>
</html>